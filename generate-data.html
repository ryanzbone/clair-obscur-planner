<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clair Obscur Data Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        p {
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        #status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
        }
        
        .success {
            background-color: #dff0d8;
            color: #3c763d;
        }
        
        .error {
            background-color: #f2dede;
            color: #a94442;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Clair Obscur Data Generator</h1>
        <p>This tool will parse the Picto data from the data.html file and generate a JavaScript file that can be directly included in the Character Planner application.</p>
        <p>Steps:</p>
        <ol>
            <li>Make sure data.html is in the same directory as this file</li>
            <li>Click the "Generate JavaScript File" button below</li>
            <li>Review the generated JavaScript code</li>
            <li>Click "Save as JavaScript File" to download the data as a .js file</li>
            <li>Place the downloaded picto-data.js file in your project directory</li>
        </ol>
        
        <button id="loadButton">Generate JavaScript File</button>
        
        <div id="status"></div>
        <div id="result"></div>
    </div>
    
    <script>
        document.getElementById('loadButton').addEventListener('click', async () => {
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            
            try {
                statusDiv.textContent = 'Loading data.html...';
                statusDiv.className = '';
                
                // Fetch the data.html file
                const response = await fetch('data.html');
                if (!response.ok) {
                    throw new Error(`Failed to load data.html: ${response.status} ${response.statusText}`);
                }
                
                const html = await response.text();
                
                // Create a temporary iframe to load the HTML
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
                
                // Write the HTML to the iframe
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                iframeDoc.open();
                iframeDoc.write(html);
                iframeDoc.close();
                
                // Load the generator script
                const script = document.createElement('script');
                script.src = 'generate-data-js.js';
                
                // Wait for the script to load
                script.onload = () => {
                    try {
                        // Call the parser function
                        const parseDataHtml = iframe.contentWindow.parseDataHtml;
                        if (!parseDataHtml) {
                            throw new Error('Parser function not found');
                        }
                        
                        const data = parseDataHtml();
                        
                        // Display success message
                        statusDiv.textContent = `Successfully parsed ${data.length} Pictos!`;
                        statusDiv.className = 'success';
                        
                        // Generate JavaScript code
                        const jsCode = `// Generated Picto data for Clair Obscur Character Planner
// Generated on: ${new Date().toLocaleString()}

const pictoData = ${JSON.stringify(data, null, 2)};

// Export the data
if (typeof module !== 'undefined' && module.exports) {
    module.exports = pictoData;
}`;
                        
                        // Display the JavaScript code
                        const pre = document.createElement('pre');
                        pre.style.maxHeight = '400px';
                        pre.style.overflow = 'auto';
                        pre.style.backgroundColor = '#f5f5f5';
                        pre.style.padding = '10px';
                        pre.style.border = '1px solid #ddd';
                        pre.style.borderRadius = '5px';
                        pre.style.margin = '20px 0';
                        pre.textContent = jsCode;
                        
                        // Create a button to save the JavaScript file
                        const saveButton = document.createElement('button');
                        saveButton.textContent = 'Save as JavaScript File';
                        saveButton.style.marginBottom = '20px';
                        saveButton.onclick = () => {
                            const blob = new Blob([jsCode], { type: 'application/javascript' });
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = 'picto-data.js';
                            a.click();
                            URL.revokeObjectURL(url);
                        };
                        
                        // Clear previous results and add new ones
                        resultDiv.innerHTML = '';
                        resultDiv.appendChild(saveButton);
                        resultDiv.appendChild(pre);
                        
                        // Clean up
                        document.body.removeChild(iframe);
                    } catch (error) {
                        console.error('Error parsing data:', error);
                        statusDiv.textContent = `Error parsing data: ${error.message}`;
                        statusDiv.className = 'error';
                        document.body.removeChild(iframe);
                    }
                };
                
                script.onerror = () => {
                    statusDiv.textContent = 'Error loading generate-data-js.js';
                    statusDiv.className = 'error';
                    document.body.removeChild(iframe);
                };
                
                iframeDoc.head.appendChild(script);
                
            } catch (error) {
                console.error('Error:', error);
                statusDiv.textContent = `Error: ${error.message}`;
                statusDiv.className = 'error';
            }
        });
    </script>
</body>
</html>
